# Overwatch Configuration Example
# Copy this file to the project root as 'overwatch.yaml' and customize for your project.

project:
  name: "MyApp"              # Display name for the admin panel
  prefix: "myapp"            # Container prefix: {prefix}-{tenantId}-{service}
  db_prefix: "myapp"         # Database prefix: {db_prefix}_{tenantId}

# Database Configuration
# Supports: mysql, mariadb, postgres
database:
  type: "postgres"           # Database type
  host: "myapp-postgres"     # Database host (container name or hostname)
  port: 5432                 # Database port
  root_user: "postgres"      # Root/superuser username
  root_password_env: "POSTGRES_PASSWORD"  # Environment variable for root password
  container_name: "myapp-postgres"        # Container name for database

# Container Registry Configuration
# Supports: ghcr (GitHub), dockerhub, ecr (AWS), custom
registry:
  type: "dockerhub"
  url: "docker.io"
  repository: "myorg/myapp"
  auth:
    type: "basic"
    username_env: "DOCKER_USERNAME"
  # tag_pattern: "^v\\d+"   # Optional: regex to filter image tags

# Services to manage per tenant
services:
  # Required backend service
  - name: "api"
    required: true
    image_suffix: "api"      # Image: {registry}/{repository}/{image_suffix}:{tag}
    health_check:
      path: "/health"
      port: 3000
    backup:
      enabled: true
      paths:
        - container: "/app/data"
          local: "data"

  # Required frontend service
  - name: "web"
    required: true
    image_suffix: "web"
    health_check:
      path: "/"
      port: 80

  # Optional worker service
  - name: "worker"
    required: false
    image_suffix: "worker"

  # Database migration init container
  - name: "migrate"
    is_init_container: true
    image_suffix: "api"

# Backup Configuration (optional)
# Uses Restic with S3-compatible storage
backup:
  enabled: true
  schedule: "0 2 * * *"       # Cron expression for automatic backups (daily at 2 AM)
  provider: "s3"               # "s3" | "local" | "azure" | "gcs"
  s3:
    endpoint_env: "S3_ENDPOINT"
    bucket_env: "S3_BUCKET"
    access_key_env: "S3_ACCESS_KEY"
    secret_key_env: "S3_SECRET_KEY"
  restic_password_env: "RESTIC_PASSWORD"

# Tenant template paths (optional, defaults shown)
# tenant_template:
#   dir: "./tenant-template"
#   compose_file: "docker-compose.yml"
#   env_template: ".env.template"

# Credential generation settings
credentials:
  db_password_length: 32     # Length of generated database passwords
  jwt_secret_length: 64      # Length of generated JWT secrets

# Network Configuration
networking:
  external_network: "myapp-network"        # External Docker network name
  tenants_path: "/opt/myapp/tenants"       # Path to store tenant configs
  # internal_network_template: "${prefix}-${tenantId}-internal"

# Admin Access (optional)
# Generate JWT tokens for accessing tenant applications directly
# admin_access:
#   enabled: true
#   url_template: "https://${domain}/admin-login?token=${token}"
#   secret_env: "AUTH_SERVICE_SECRET"
#   token_payload:
#     admin_flag: "isSystemAdmin"
#     email_template: "admin@overwatch.local"
#     name: "System Admin"

# Data directory for persistent files (admin-users.json, env-vars.json, audit.log)
# data_dir: "/app/data"
